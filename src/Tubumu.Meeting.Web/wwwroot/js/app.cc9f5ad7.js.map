{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue?7e02","webpack:///./src/App.vue?ee30","webpack:///./src/lib/Logger.js","webpack:///src/App.vue","webpack:///./src/App.vue?1160","webpack:///./src/App.vue?bff9","webpack:///./src/main.js"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","_vm","this","_h","$createElement","_c","_self","attrs","_v","_s","serveModeText","staticClass","ref","connectForm","isConnected","model","callback","$$v","$set","expression","_l","item","index","on","handleConnect","roomForm","isJoinedRoom","handleJoinRoom","_e","peersForm","staticStyle","peers","onPeerNodeClick","webcamProducer","domProps","localVideoStream","staticRenderFns","APP_NAME","Logger","prefix","_debug","debug","_warn","_error","log","console","info","warn","error","qvga","vga","optional","localStorage","setItem","components","serveMode","connection","mediasoupDevice","sendTransport","recvTransport","nextDataChannelTestNumber","webcams","audioDevices","micProducer","useSimulcast","forceH264","forceVP9","forceTcp","localAudioStream","remoteVideoStreams","remoteAudioStreams","producers","Map","consumers","dataProducer","dataConsumers","peerId","roomId","defaultProps","form","consume","produce","useDataChannel","rooms","accessTokens","computed","isAdmin","methods","micClosed","close","webcamClosed","component","Vue","config","productionTip","use","ElementUI","render","h","App","$mount"],"mappings":"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","file":"js/app.cc9f5ad7.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=css&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[_c('el-container',[_c('el-header',[_vm._v(\"Demo - 服务模式: \"+_vm._s(_vm.serveModeText))]),_c('el-container',[_c('el-aside',{attrs:{\"width\":\"400px\"}},[_c('div',{staticClass:\"demo-block\"},[_c('el-form',{ref:\"connectForm\",attrs:{\"inline\":true,\"label-width\":\"80px\",\"size\":\"mini\"}},[_c('el-form-item',{attrs:{\"label\":\"Peer:\"}},[_c('el-select',{attrs:{\"disabled\":_vm.connectForm.isConnected,\"clearable\":\"\",\"placeholder\":\"请选择\"},model:{value:(_vm.connectForm.peerId),callback:function ($$v) {_vm.$set(_vm.connectForm, \"peerId\", $$v)},expression:\"connectForm.peerId\"}},_vm._l((_vm.accessTokens),function(item,index){return _c('el-option',{key:item,attrs:{\"label\":(\"Peer \" + index + (index == 8 || index === 9 ? '(admin)' : '')),\"value\":index}})}),1)],1),_c('el-form-item',[_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.handleConnect}},[_vm._v(_vm._s((!_vm.connectForm.isConnected ? \"Connect\" : \"Disconnect\")))])],1)],1)],1),(_vm.connectForm.isConnected)?_c('div',{staticClass:\"demo-block\"},[_c('el-form',{ref:\"roomForm\",attrs:{\"inline\":true,\"model\":_vm.roomForm,\"label-width\":\"80px\",\"size\":\"mini\"}},[_c('el-form-item',{attrs:{\"label\":\"Room:\"}},[_c('el-select',{attrs:{\"disabled\":_vm.roomForm.isJoinedRoom,\"clearable\":\"\",\"placeholder\":\"请选择\"},model:{value:(_vm.roomForm.roomId),callback:function ($$v) {_vm.$set(_vm.roomForm, \"roomId\", $$v)},expression:\"roomForm.roomId\"}},_vm._l((_vm.rooms),function(item,index){return _c('el-option',{key:item,attrs:{\"label\":(\"Room \" + index),\"value\":index}})}),1)],1),_c('el-form-item',[_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.handleJoinRoom}},[_vm._v(_vm._s((!_vm.roomForm.isJoinedRoom ? \"Join\" : \"Leave\")))])],1)],1)],1):_vm._e(),(_vm.connectForm.isConnected&&_vm.roomForm.isJoinedRoom)?_c('div',{staticClass:\"demo-block\"},[_c('el-form',{ref:\"peersForm\",attrs:{\"model\":_vm.peersForm,\"label-width\":\"80px\",\"size\":\"mini\"}},[_c('el-form-item',[_c('el-table',{ref:\"singleTable\",staticStyle:{\"width\":\"100%\"},attrs:{\"data\":_vm.peersForm.peers,\"highlight-current-row\":\"\"},on:{\"current-change\":_vm.onPeerNodeClick}},[_c('el-table-column',{attrs:{\"type\":\"index\",\"width\":\"50\"}}),_c('el-table-column',{attrs:{\"property\":\"displayName\",\"label\":\"DisplayName\"}})],1)],1)],1)],1):_vm._e()]),_c('el-main',[(!!_vm.webcamProducer)?_c('video',{ref:\"localVideo\",attrs:{\"id\":\"localVideo\",\"autoplay\":\"\",\"playsinline\":\"\"},domProps:{\"srcObject\":_vm.localVideoStream}}):_vm._e(),_vm._l((_vm.remoteVideoStreams),function(value,key){return _c('video',{key:key,attrs:{\"autoplay\":\"\",\"playsinline\":\"\"},domProps:{\"srcObject\":value}})}),_vm._l((_vm.remoteAudioStreams),function(value,key){return _c('audio',{key:key,attrs:{\"autoplay\":\"\"},domProps:{\"srcObject\":value}})})],2)],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import debug from 'debug';\n\nconst APP_NAME = 'tubumu-meeting-demo-client';\n\nexport default class Logger {\n    constructor(prefix) {\n        if (prefix) {\n            this._debug = debug(`${APP_NAME}:${prefix}`);\n            this._warn = debug(`${APP_NAME}:WARN:${prefix}`);\n            this._error = debug(`${APP_NAME}:ERROR:${prefix}`);\n        } else {\n            this._debug = debug(APP_NAME);\n            this._warn = debug(`${APP_NAME}:WARN`);\n            this._error = debug(`${APP_NAME}:ERROR`);\n        }\n\n        /* eslint-disable no-console */\n        this._debug.log = console.info.bind(console);\n        this._warn.log = console.warn.bind(console);\n        this._error.log = console.error.bind(console);\n        /* eslint-enable no-console */\n    }\n\n    get debug() {\n        return this._debug;\n    }\n\n    get warn() {\n        return this._warn;\n    }\n\n    get error() {\n        return this._error;\n    }\n}","<template>\n  <div id=\"app\">\n    <el-container>\n      <el-header>Demo - 服务模式: {{serveModeText}}</el-header>\n        <el-container>\n          <el-aside width=\"400px\">            \n            <div class=\"demo-block\">\n              <el-form ref=\"connectForm\" :inline=\"true\" label-width=\"80px\" size=\"mini\">\n                <el-form-item label=\"Peer:\">\n                  <el-select v-model=\"connectForm.peerId\" :disabled=\"connectForm.isConnected\" clearable placeholder=\"请选择\">\n                    <el-option :label=\"`Peer ${index}${index == 8 || index === 9 ? '(admin)' : ''}`\" v-for=\"(item, index) in accessTokens\" :key=\"item\" :value=\"index\"></el-option>\n                  </el-select>\n                </el-form-item>\n                <el-form-item>\n                  <el-button type=\"primary\" @click=\"handleConnect\">{{(!connectForm.isConnected ? \"Connect\" : \"Disconnect\")}}</el-button>\n                </el-form-item>\n              </el-form>\n            </div>\n            <div class=\"demo-block\" v-if=\"connectForm.isConnected\">\n              <el-form ref=\"roomForm\" :inline=\"true\" :model=\"roomForm\" label-width=\"80px\" size=\"mini\">\n                <el-form-item label=\"Room:\">\n                  <el-select v-model=\"roomForm.roomId\" :disabled=\"roomForm.isJoinedRoom\" clearable placeholder=\"请选择\">\n                    <el-option :label=\"`Room ${index}`\" v-for=\"(item, index) in rooms\" :key=\"item\" :value=\"index\"></el-option>\n                  </el-select>\n                </el-form-item>\n                <el-form-item>\n                  <el-button type=\"primary\" @click=\"handleJoinRoom\">{{(!roomForm.isJoinedRoom ? \"Join\" : \"Leave\")}}</el-button>\n                </el-form-item>\n              </el-form>\n            </div>\n            <div class=\"demo-block\" v-if=\"connectForm.isConnected&&roomForm.isJoinedRoom\">\n              <el-form ref=\"peersForm\" :model=\"peersForm\" label-width=\"80px\" size=\"mini\">\n                <el-form-item>\n                  <el-table\n                    ref=\"singleTable\"\n                    :data=\"peersForm.peers\"\n                    highlight-current-row\n                    @current-change=\"onPeerNodeClick\"\n                    style=\"width: 100%\">\n                    <el-table-column\n                      type=\"index\"\n                      width=\"50\">\n                    </el-table-column>\n                    <el-table-column\n                      property=\"displayName\"\n                      label=\"DisplayName\">\n                    </el-table-column>\n                  </el-table>\n               </el-form-item>\n              </el-form>\n            </div>\n          </el-aside>\n          <el-main>\n            <video id=\"localVideo\" ref=\"localVideo\" v-if=\"!!webcamProducer\" :srcObject.prop=\"localVideoStream\" autoplay playsinline />\n            <video v-for=\"(value, key) in remoteVideoStreams\" :key=\"key\" :srcObject.prop=\"value\" autoplay playsinline />\n            <audio v-for=\"(value, key) in remoteAudioStreams\" :key=\"key\" :srcObject.prop=\"value\" autoplay />\n          </el-main>\n        </el-container>\n    </el-container>\n  </div>\n</template>\n\n<script>\nimport Logger from './lib/Logger';\nimport * as mediasoupClient from 'mediasoup-client';\nimport * as signalR from '@microsoft/signalr';\n\n// eslint-disable-next-line no-unused-vars\nconst VIDEO_CONSTRAINS = {\n  qvga: { width: { ideal: 320 }, height: { ideal: 240 } },\n  vga: { width: { ideal: 640 }, height: { ideal: 480 } },\n  '720P': { width: { ideal: 1280 }, height: { ideal: 720 } },\n  '1080P': { width: { ideal: 1920 }, height: { ideal: 1080 } },\n  '4k': { width: { ideal: 4096 }, height: { ideal: 2160 } }\n};\n\nconst PC_PROPRIETARY_CONSTRAINTS = {\n  optional: [{ googDscp: true }]\n};\n\n// eslint-disable-next-line no-unused-vars\nconst WEBCAM_SIMULCAST_ENCODINGS = [\n  { scaleResolutionDownBy: 4, maxBitrate: 500000 },\n  { scaleResolutionDownBy: 2, maxBitrate: 1000000 },\n  { scaleResolutionDownBy: 1, maxBitrate: 5000000 }\n];\n\n// Used for VP9 webcam video.\n// eslint-disable-next-line no-unused-vars\nconst WEBCAM_KSVC_ENCODINGS = [\n  { scalabilityMode: 'S3T3_KEY' }\n];\n\n// Used for simulcast screen sharing.\n// eslint-disable-next-line no-unused-vars\nconst SCREEN_SHARING_SIMULCAST_ENCODINGS =\n[\n  { dtx: true, maxBitrate: 1500000 },\n  { dtx: true, maxBitrate: 6000000 }\n];\n\n// Used for VP9 screen sharing.\n// eslint-disable-next-line no-unused-vars\nconst SCREEN_SHARING_SVC_ENCODINGS =\n[\n  { scalabilityMode: 'S3T3', dtx: true }\n];\n\nconst logger = new Logger('App');\n\n// 'mediasoup-client:* tubumu-meeting-demo-client:*'\nlocalStorage.setItem('debug', 'mediasoup-client:* tubumu-meeting-demo-client:*');\n\nexport default {\n  name: 'app',\n  components: {},\n  data() {\n    return {\n      serveMode: 'Open',\n      connection: null,\n      mediasoupDevice: null,\n      sendTransport: null,\n      recvTransport: null,\n      nextDataChannelTestNumber: 0,\n      webcams: {},\n      audioDevices: {},\n      webcamProducer: null,\n      micProducer: null,\n      useSimulcast: false,\n      forceH264: false,\n      forceVP9: false,\n      forceTcp: true,\n      localAudioStream: null,\n      localVideoStream: null,\n      remoteVideoStreams: {},\n      remoteAudioStreams: {},\n      producers: new Map(),\n      consumers: new Map(),\n      dataProducer: null,\n      dataConsumers: new Map(),\n      connectForm: {\n        peerId: null,\n        isConnected: false\n      },\n      roomForm: {\n        roomId: [],\n        isJoinedRoom: false\n      },\n      peersForm: {\n        peers: [],\n      },\n      defaultProps: {\n          children: 'children',\n          label: 'label'\n      },\n      form: {\n        consume: true,\n        produce: true,\n        useDataChannel: false\n      },\n      rooms: [\n        \"Room 0\",\n        \"Room 1\",\n        \"Room 2\",\n        \"Room 3\",\n        \"Room 4\",\n        \"Room 5\",\n        \"Room 6\",\n        \"Room 7\",\n        \"Room 8\",\n        \"Room 9\"\n      ],\n      accessTokens: [\n          'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiMCIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.lX6ff6ZFNb4z-4otDcUAZ48qwD8rZAGM5_Rt4HlHgug',\n          'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiMSIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.5w00ixg06pRPxcdbtbmRVI6Wy_Ta9qsSJc3D7PE3chQ',\n          'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiMiIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.q2tKWUa6i4u0VpZDhA8Fw92NoV_g9YQeWD-OeF7fAvU',\n          'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiMyIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.ekjd10Bortc1q34Ani1F_Gw9KQwS4qRFIU715pE1lGo',\n          'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiNCIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.6hZ4GtamurlemceCV7I5vT-UQkbszRxys5h8QOiOhcE',\n          'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiNSIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.nV4fr0tYGDR7zsykNoFYERdVSUPSqmhGdOkPqBjK1qw',\n          'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiNiIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.ftPY4GXCyyuaIaeihsexS99iluUCSZo6XSUOfdf_gGs',\n          'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiNyIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.V_S8YRRCOWP5-TG8S_cvlWdaXEKpsgY34lt3FiCgqGw',\n          'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiOCIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.fl1jA6DEQyXwIb6KRDUlEthR2G7-Je3OiaZHJ3tzk9M',\n          'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiOSIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.3Hnnkoxe52L7joy99dXkcIjHtz9FUitf4BGYCYjyKdE'\n        ]\n    };\n  },\n  computed: {\n    isAdmin: function () {\n      return this.connectForm.peerId === 8 || this.connectForm.peerId === 9\n    },\n    serveModeText: function () {\n      return this.serveMode === 'Open' ? '开放(Open)模式' : this.serveMode === 'Invite' ? '邀请(Invite)模式' : '拉取(Pull)模式'\n    }\n  },\n  async mounted() {\n    var searchParams = new URLSearchParams(location.search.replace('?', ''));\n    this.connectForm.peerId = searchParams.get('peerId') || searchParams.get('peerid');\n    if(this.connectForm.peerId) {\n      this.connectForm.peerId = parseInt(this.connectForm.peerId);\n    }\n\n    this.roomForm.roomId =  searchParams.get('roomId') || searchParams.get('roomid');\n    if(this.roomForm.roomId) {\n      this.roomForm.roomId = parseInt(this.roomForm.roomId);\n    }\n\n    // For Testing\n    // this.form.produce = this.connectForm.peerId !== '0' && this.connectForm.peerId !== '1';\n  },\n  methods: {\n    async handleConnect() {\n      if(this.connectForm.isConnected) {\n        if(this.connection) {\n         await this.connection.stop();\n        }\n        this.connectForm.isConnected = false;\n        this.roomForm.isJoinedRoom = false;\n        this.webcamClosed();\n        this.micClosed();\n        this.peersForm.peers = [];\n        this.remoteVideoStreams = {};\n        this.remoteAudioStreams = {};\n        return;\n      }\n\n      if(!this.connectForm.peerId && this.connectForm.peerId !== 0) {\n        this.$message.error('Select a peer, please.');\n        return;\n      }\n\n      try {\n        const host = process.env.NODE_ENV === 'production' ? '' : `https://${window.location.hostname}:9001`;\n        this.connection = new signalR.HubConnectionBuilder()\n          .withUrl(\n            `${host}/hubs/meetingHub`, {\n              accessTokenFactory: () => this.accessTokens[this.connectForm.peerId],\n              skipNegotiation: true,\n              transport: signalR.HttpTransportType.WebSockets,\n            }\n          )\n          // .withAutomaticReconnect({\n          //   nextRetryDelayInMilliseconds: retryContext => {\n          //     if (retryContext.elapsedMilliseconds < 60000) {\n          //       // If we've been reconnecting for less than 60 seconds so far,\n          //       // wait between 0 and 10 seconds before the next reconnect attempt.\n          //       return Math.random() * 10000;\n          //     } else {\n          //       // If we've been reconnecting for more than 60 seconds so far, stop reconnecting.\n          //       return null;\n          //     }\n          //   }\n          // })\n          .build();\n\n        this.connection.onclose(e => {\n          this.connectForm.isConnected = false;\n          this.roomForm.isJoinedRoom = false;\n          this.peersForm.peers = [];\n          this.disableMic();\n          this.disableWebcam();\n          if(e) {\n            logger.error(e)\n          }\n        });\n\n        this.connection.on('Notify', async data => {\n          await this.processNotification(data);\n        });\n        await this.connection.start();\n        await this.start();\n        this.connectForm.isConnected = true;\n      } catch (e) {\n        logger.debug(e.message);\n      }\n    },\n    async start() {\n      let result = await this.connection.invoke('GetServeMode');\n      if (result.code !== 200) {\n        logger.error(`start() | GetServeMode failed: ${result.message}`);\n        this.$message.error(`start() | GetServeMode failed: ${result.message}`);\n        return;\n      }\n      this.serveMode = result.data.serveMode;\n\n      result = await this.connection.invoke('GetRouterRtpCapabilities');\n      if (result.code !== 200) {\n        logger.error(`start() | GetRouterRtpCapabilities failed: ${result.message}`);\n        this.$message.error(`start() | GetRouterRtpCapabilities failed: ${result.message}`);\n        return;\n      }\n\n      const routerRtpCapabilities = result.data;\n      this.mediasoupDevice = new mediasoupClient.Device();\n      await this.mediasoupDevice.load({\n        routerRtpCapabilities\n      });\n\n      // NOTE: Stuff to play remote audios due to browsers' new autoplay policy.\n      //\n      // Just get access to the mic and DO NOT close the mic track for a while.\n      // Super hack!\n      // {\n      //   const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      //   const audioTrack = stream.getAudioTracks()[0];\n\n      //   audioTrack.enabled = false;\n\n      //   setTimeout(() => audioTrack.stop(), 120000);\n      // }\n      \n      // GetRouterRtpCapabilities 成功, Join\n      result = await this.connection.invoke('Join', {\n        rtpCapabilities: this.mediasoupDevice.rtpCapabilities,\n        sctpCapabilities: this.form.useDataChannel && this.form.consume\n\t\t\t\t\t\t? this.mediasoupDevice.sctpCapabilities\n\t\t\t\t\t\t: undefined,\n        displayName: null,\n        sources: ['mic', 'webcam'],\n        appData: {}\n      });\n      if (result.code !== 200) {\n        logger.error(`processNotification() | Join failed: ${result.message}`);\n        this.$message.error(`processNotification() | Join failed: ${result.message}`);\n        return;\n      }\n    },\n    async handleJoinRoom() {\n      if(this.roomForm.isJoinedRoom) {\n        let result = await this.connection.invoke('LeaveRoom');\n        if (result.code !== 200) {\n          logger.error(`handleJoinRoom() | LeaveRoom failed: ${result.message}`)\n          this.$message.error(`handleJoinRoom() | LeaveRoom failed: ${result.message}`);\n          return;\n        }\n        this.peersForm.peers = [];\n        this.roomForm.isJoinedRoom = false;\n        return;\n      } \n      if(!this.roomForm.roomId && this.roomForm.roomId !== 0) {\n        this.$message.error('Select a room, please.');\n        return;\n      }\n\n      let result = await this.connection.invoke('JoinRoom', {\n        roomId: this.roomForm.roomId.toString(),\n        role: this.isAdmin ? \"admin\" : \"normal\"\n      });\n      if (result.code !== 200) {\n        logger.error('handleJoinRoom() | JoinRoom failed.');\n        this.$message.error(`handleJoinRoom() | JoinRoom failed: ${result.message}`);\n        return;\n      }\n\n      let {peers} = result.data;\n      for(let i = 0; i < peers.length; i++) {\n        this.peersForm.peers.push(peers[i]);\n      }\n      this.roomForm.isJoinedRoom = true;\n\n      if(this.form.produce) {\n        // Join成功，CreateSendWebRtcTransport(生产) \n        result = await this.connection.invoke('CreateSendWebRtcTransport', {\n          forceTcp: this.forceTcp,\n          sctpCapabilities: this.form.useDataChannel\n\t\t\t\t\t\t\t? this.mediasoupDevice.sctpCapabilities\n\t\t\t\t\t\t\t: undefined\n        });\n        if (result.code !== 200) {\n          logger.error(`handleJoinRoom() | CreateSendWebRtcTransport failed: ${result.message}`);\n          this.$message.error(`handleJoinRoom() | CreateSendWebRtcTransport failed: ${result.message}`);\n          return;\n        }\n\n        // CreateSendWebRtcTransport(生产)成功, createSendTransport\n        this.sendTransport = this.mediasoupDevice.createSendTransport({\n          id: result.data.transportId,\n          iceParameters: result.data.iceParameters,\n          iceCandidates: result.data.iceCandidates,\n          dtlsParameters: result.data.dtlsParameters,\n          sctpParameters: result.data.sctpParameters,\n          iceServers: [],\n          proprietaryConstraints: PC_PROPRIETARY_CONSTRAINTS\n        });\n\n        this.sendTransport.on(\n          'connect',\n          ({ dtlsParameters }, callback, errback) => {\n            logger.debug('sendTransport.on() connect dtls: %o', dtlsParameters);\n            this.connection\n              .invoke('ConnectWebRtcTransport', {\n                transportId: this.sendTransport.id,\n                dtlsParameters\n              })\n              .then(callback)\n              .catch(errback);\n          }\n        );\n\n        this.sendTransport.on(\n          'produce',\n          // appData 需要包含 source\n          // eslint-disable-next-line no-unused-vars\n          async ({ kind, rtpParameters, appData }, callback, errback) => {\n            logger.debug('sendTransport.on() produce, appData: %o', appData);\n            try {\n              const result = await this.connection.invoke('Produce', {\n                transportId: this.sendTransport.id,\n                kind,\n                rtpParameters,\n                source: appData.source,\n                appData\n              });\n              if (result.code !== 200) {\n                logger.error(`sendTransport 'produce' callbak | failed: ${result.message}`);\n                this.$message.error(`sendTransport 'produce' callbak | failed: ${result.message}`);\n                errback(new Error(result.message));\n                return;\n              }\n              this.producers.set(result.data.id, result.data);\n              callback({ id: result.data.id });\n            } catch (error) {\n              errback(error);\n            }\n          }\n        );\n\n        this.sendTransport.on('producedata', async (\n\t\t\t\t\t{\n\t\t\t\t\t\tsctpStreamParameters,\n\t\t\t\t\t\tlabel,\n\t\t\t\t\t\tprotocol,\n\t\t\t\t\t\tappData\n\t\t\t\t\t},\n\t\t\t\t\tcallback,\n\t\t\t\t\terrback\n\t\t\t\t) =>\n\t\t\t\t{\n\t\t\t\t\tlogger.debug('\"producedata\" event: [sctpStreamParameters:%o, appData:%o]', sctpStreamParameters, appData);\n\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\t// eslint-disable-next-line no-shadow\n\t\t\t\t\t\tconst { id } = await this._protoo.request(\n\t\t\t\t\t\t\t'ProduceData',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttransportId : this.sendTransport.id,\n\t\t\t\t\t\t\t\tsctpStreamParameters,\n\t\t\t\t\t\t\t\tlabel,\n\t\t\t\t\t\t\t\tprotocol,\n\t\t\t\t\t\t\t\tappData\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\tcallback({ id });\n\t\t\t\t\t}\n\t\t\t\t\tcatch (error)\n\t\t\t\t\t{\n\t\t\t\t\t\terrback(error);\n\t\t\t\t\t}\n        });\n        \n        this.sendTransport.on('connectionstatechange', connectionState => {\n          logger.debug(`sendTransport.on() connectionstatechange: ${connectionState}`);\n          if (connectionState === 'connected')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.enableDataProducer();\n\t\t\t\t\t}\n        });\n      }\n      // createSendTransport 成功, CreateRecvWebRtcTransport(消费)\n      result = await this.connection.invoke('CreateRecvWebRtcTransport', {\n        forceTcp: this.forceTcp,\n        sctpCapabilities: this.form.useDataChannel\n\t\t\t\t\t\t\t? this._mediasoupDevice.sctpCapabilities\n\t\t\t\t\t\t\t: undefined\n      });\n\n      // CreateRecvWebRtcTransport(消费)成功, createRecvTransport\n      this.recvTransport = this.mediasoupDevice.createRecvTransport({\n        id: result.data.transportId,\n        iceParameters: result.data.iceParameters,\n        iceCandidates: result.data.iceCandidates,\n        dtlsParameters: result.data.dtlsParameters,\n        sctpParameters: result.data.sctpParameters,\n        iceServers: []\n      });\n\n      this.recvTransport.on(\n        'connect',\n        ({ dtlsParameters }, callback, errback) => {\n          logger.debug('recvTransport.on() connect dtls: %o', dtlsParameters);\n          this.connection\n            .invoke('ConnectWebRtcTransport', {\n              transportId: this.recvTransport.id,\n              dtlsParameters\n            })\n            .then(callback)\n            .catch(errback);\n        }\n      );\n\n      this.recvTransport.on('connectionstatechange', connectionState => {\n        logger.debug(`recvTransport.on() connectionstatechange: ${connectionState}`);\n      });\n\n      if(this.serveMode === 'Open') {\n        await this.enableMic();\n        await this.enableWebcam();\n      }\n\n      if(this.serveMode !== 'Pull') {\n        let result = await this.connection.invoke('Ready');\n        if (result.code !== 200) {\n          logger.error(`Ready() | failed: ${result.message}`);\n          this.$message.error(`Ready() | failed: ${result.message}`);\n          return;\n        }\n      }\n    },\n    async onPeerNodeClick(peer) {\n      if(!peer) return;\n      logger.debug('onPeerNodeClick() | %o', peer);\n      if(this.serveMode === 'Pull') {\n        await this.pull(peer.peerId, peer.sources)\n      } else if(this.serveMode === 'Invite') {\n        if(this.isAdmin) {\n          await this.invite(peer.peerId, peer.sources)\n        } \n        else\n        {\n          this.$message.error('仅管理员可进行邀请操作。');\n        }\n      }\n    },\n    async processNewConsumer(data) {\n      const {\n        producerPeerId,\n        producerId,\n        consumerId,\n        kind,\n        rtpParameters,\n        //type, // mediasoup-client 的 Transport.ts 不使用该参数\n        producerAppData,\n        //producerPaused // mediasoup-client 的 Transport.ts 不使用该参数\n      } = data;\n\n      const consumer = await this.recvTransport.consume({\n        id: consumerId,\n        producerId,\n        kind,\n        rtpParameters,\n        appData: { ...producerAppData, producerPeerId } // Trick.\n      });\n      logger.debug('processNewConsumer() Consumer: %o', consumer);\n\n      // Store in the map.\n      this.consumers.set(consumer.id, consumer);\n\n      consumer.on('transportclose', () => {\n        this.consumers.delete(consumer.id);\n      });\n\n      const {\n        // eslint-disable-next-line no-unused-vars\n        spatialLayers,\n        // eslint-disable-next-line no-unused-vars\n        temporalLayers\n      } = mediasoupClient.parseScalabilityMode(\n        consumer.rtpParameters.encodings[0].scalabilityMode\n      );\n\n      /*\n      if (kind === 'audio') {\n        consumer.volume = 0;\n\n        const stream = new MediaStream();\n\n        stream.addTrack(consumer.track);\n\n        if (!stream.getAudioTracks()[0]) {\n          throw new Error(\n            'request.newConsumer | given stream has no audio track'\n          );\n        }\n      }\n      */\n\n      const stream = new MediaStream();\n      stream.addTrack(consumer.track);\n\n      this.$set(kind === 'video' ? this.remoteVideoStreams : this.remoteAudioStreams, consumerId, stream);\n\n      // We are ready. Answer the request so the server will\n      // resume this Consumer (which was paused for now).\n      logger.debug('processNewConsumer() ResumeConsumer');\n      const result = await this.connection.invoke('ResumeConsumer', consumerId);\n      if (result.code !== 200) {\n        logger.error(`processNewConsumer() | ResumeConsumer failed: ${result.message}`);\n        this.$message.error(`processNewConsumer() | ResumeConsumer failed: ${result.message}`);\n        return;\n      }\n    },\n    async processNewDataConsumer(data) {\n      const {\n        dataProducerPeerId, // NOTE: Null if bot.\n        dataProducerId,\n        dataCosumerId,\n        sctpStreamParameters,\n        label,\n        protocol,\n        dataProducerAppData\n      } = data;\n\n      try\n      {\n        const dataConsumer = await this.recvTransport.consumeData(\n          {\n            dataCosumerId,\n            dataProducerId,\n            sctpStreamParameters,\n            label,\n            protocol,\n            appData : { ...dataProducerAppData, dataProducerPeerId } // Trick.\n          });\n\n        // Store in the map.\n        this.dataConsumers.set(dataConsumer.id, dataConsumer);\n\n        dataConsumer.on('transportclose', () =>\n        {\n          this.dataConsumers.delete(dataConsumer.id);\n        });\n\n        dataConsumer.on('open', () =>\n        {\n          logger.debug('DataConsumer \"open\" event');\n        });\n\n        dataConsumer.on('close', () =>\n        {\n          logger.warn('DataConsumer \"close\" event');\n          this.dataConsumers.delete(dataConsumer.id);\n        });\n\n        dataConsumer.on('error', (error) =>\n        {\n          logger.error('DataConsumer \"error\" event:%o', error);\n        });\n\n        dataConsumer.on('message', (message) =>\n        {\n          logger.debug('DataConsumer \"message\" event [streamId:%d]', dataConsumer.sctpStreamParameters.streamId);\n\n          if (message instanceof ArrayBuffer)\n          {\n            const view = new DataView(message);\n            const number = view.getUint32();\n\n            if (number == Math.pow(2, 32) - 1)\n            {\n              logger.warn('dataChannelTest finished!');\n              this.nextDataChannelTestNumber = 0;\n\n              return;\n            }\n\n            if (number > this.nextDataChannelTestNumber)\n            {\n              logger.warn(\n                'dataChannelTest: %s packets missing',\n                number - this.nextDataChannelTestNumber);\n            }\n\n            this.nextDataChannelTestNumber = number + 1;\n\n            return;\n          }\n          else if (typeof message !== 'string')\n          {\n            logger.warn('ignoring DataConsumer \"message\" (not a string)');\n\n            return;\n          }\n\n          logger.debug(`New message: ${message}`);\n        });\n      }\n      catch (error)\n      {\n        logger.error('\"newDataConsumer\" request failed:%o', error);\n        throw error;\n      }\n    },\n    async pull(peerId, sources) {\n      const result = await this.connection.invoke('Pull', {\n        peerId,\n        sources\n      });\n      if (result.code !== 200) {\n        logger.error(`pull() | failed: ${result.message}`);\n        this.$message.error(`pull() | failed: ${result.message}`);\n        return;\n      }\n    },\n    async invite(peerId, sources) {\n      const result = await this.connection.invoke('Invite', {\n        peerId,\n        sources\n      });\n      if (result.code !== 200) {\n        logger.error(`invite() | failed: ${result.message}`);\n        this.$message.error(`invite() | failed: ${result.message}`);\n        return;\n      }\n    },\n    async processNotification(data) {\n      logger.debug('processNotification() | %o', data);\n      switch (data.type) {\n        case 'newConsumer': {\n            await this.processNewConsumer(data.data);\n            \n            break;\n        }\n\n        case 'newDataConsumer': {\n            await this.processNewDataConsumer(data.data);\n\n            break;\n        }\n\n        case 'producerScore': {\n          // eslint-disable-next-line no-unused-vars\n          const { producerId, score } = data.data;\n\n          break;\n        }\n\n        case 'peerJoinRoom': {\n          // eslint-disable-next-line no-unused-vars\n          const {peer} = data.data;\n          this.peersForm.peers.push(peer);\n          break;\n        }\n\n        case 'peerLeaveRoom':\n        {\n          // eslint-disable-next-line no-unused-vars\n          const { peerId } = data.data;\n          let idx = -1;\n          for(let i = 0; i < this.peersForm.peers.length; i++) {\n            if(this.peersForm.peers[i].peerId === peerId) {\n              idx = i;\n              break;\n            }\n          }\n          if(idx >= 0){\n            this.peersForm.peers.splice(idx, 1);\n          }\n          break;\n        }\n        \n        case 'peerRoomAppDataChanged': {\n\n          break;\n        }\n\n        case 'produceSources':\n        {\n          if(!this.form.produce) break;\n\n          const { /*roomId, */sources } = data.data;\n          for(let i =0; i < sources.length; i++){\n            if(sources[i] === 'mic' && this.mediasoupDevice.canProduce('audio')) {\n              if(!this.micProducer) {\n                await this.enableMic();\n              }\n            } else if(sources[i] === 'webcam' && this.mediasoupDevice.canProduce('video')) {\n              if(!this.webcamProducer) {\n                await this.enableWebcam();\n              }\n            }\n          }\n\n          break;\n        }\n\n        case 'downlinkBwe':\n        {\n          logger.debug('\\'downlinkBwe\\' event: %o', data.data);\n\n          break;\n        }\n\n        case 'consumerClosed': {\n          const { consumerId } = data.data;\n          const consumer = this.consumers.get(consumerId);\n\n          if (!consumer) break;\n\n          this.$delete(consumer.kind === 'video' ? this.remoteVideoStreams : this.remoteAudioStreams, consumerId)\n          consumer.close();\n          this.consumers.delete(consumerId);\n\n          break;\n        }\n\n        case 'consumerPaused': {\n          const { consumerId } = data.data;\n          const consumer = this.consumers.get(consumerId);\n\n          if (!consumer) break;\n\n          break;\n        }\n\n        case 'consumerResumed': {\n          const { consumerId } = data.data;\n          const consumer = this.consumers.get(consumerId);\n\n          if (!consumer) break;\n\n          break;\n        }\n\n        case 'consumerLayersChanged': {\n          // eslint-disable-next-line no-unused-vars\n          const { consumerId, spatialLayer, temporalLayer } = data.data;\n          const consumer = this.consumers.get(consumerId);\n\n          if (!consumer) break;\n\n          break;\n        }\n\n        case 'consumerScore': {\n          const { consumerId } = data.data;\n          const consumer = this.consumers.get(consumerId);\n\n          if (!consumer) break;\n\n          break;\n        }\n\n        case 'producerClosed': {\n          const { producerId } = data.data;\n          const producer = this.producers.get(producerId);\n\n          if (!producer) break;\n\n          if(producer.source === 'webcam') {\n            this.webcamClosed();\n          } else if(producer.source === 'mic') {\n            this.micClosed();\n          }\n\n          break;\n        }\n\n        case 'peerLeave': {\n          const { peerId } = data.data;\n          for(let i = this.peersForm.peers.length - 1; i > 0; i--) {\n            if(this.peersForm.peers[i].peerId === peerId) {\n              this.peersForm.peers.splice(i, 1);\n              break;\n            }\n          }\n          break;\n        }\n\n        case 'producerVideoOrientationChanged': {\n          break;\n        }\n\n        default: {\n          logger.error('unknown data.type, data:%o', data);\n        }\n      }\n    },\n    async enableDataProducer()\n    {\n      logger.debug('enableChatDataProducer()');\n\n      if (!this.form.useDataChannel)\n        return;\n\n      try\n      {\n        this.dataProducer = await this.sendTransport.produceData(\n          {\n            ordered        : false,\n            maxRetransmits : 1,\n            label          : 'chat',\n            priority       : 'medium',\n            appData        : { info: '' }\n          });\n\n        this.dataProducer.on('transportclose', () =>\n        {\n          this.dataProducer = null;\n        });\n\n        this.dataProducer.on('open', () =>\n        {\n          logger.debug('DataProducer \"open\" event');\n        });\n\n        this.dataProducer.on('close', () =>\n        {\n          logger.error('DataProducer \"close\" event');\n\n          this.dataProducer = null;\n        });\n\n        this.dataProducer.on('error', (error) =>\n        {\n          logger.error('chat DataProducer \"error\" event:%o', error);\n        });\n\n        this.dataProducer.on('bufferedamountlow', () =>\n        {\n          logger.debug('chat DataProducer \"bufferedamountlow\" event');\n        });\n      }\n      catch (error)\n      {\n        logger.error('enableDataProducer() | failed:%o', error);\n\n        throw error;\n      }\n    },\n    async enableMic() {\n      logger.debug('enableMic()');\n\n      if (this.micProducer) return;\n      if (this.mediasoupDevice && !this.mediasoupDevice.canProduce('audio')) {\n        logger.error('enableMic() | cannot produce audio');\n        return;\n      }\n\n      let track;\n\n      try {\n        const deviceId = await this._getAudioDeviceId();\n\n        const device = this.audioDevices[deviceId];\n\n        if (!device) throw new Error('no audio devices');\n\n        logger.debug(\n          'enableMic() | new selected audio device [device:%o]',\n          device\n        );\n\n        logger.debug('enableMic() | calling getUserMedia()');\n\n        const stream = await navigator.mediaDevices.getUserMedia({\n          audio: {\n            deviceId: { ideal: deviceId }\n          }\n        });\n        this.localAudioStream = stream;\n\n        track = stream.getAudioTracks()[0];\n\n        this.micProducer = await this.sendTransport.produce({\n          track,\n          codecOptions: {\n            opusStereo: 1,\n            opusDtx: 1\n          },\n          appData: { source: 'mic' }\n        });\n\n        this.micProducer.on('transportclose', () => {\n          this.micProducer = null;\n        });\n\n        this.micProducer.on('trackended', () => {\n          this.disableMic().catch(() => {});\n        });\n\n        this.micProducer.volume = 0;\n      } catch (error) {\n        console.log('enableMic() failed: %o', error);\n        logger.error('enableMic() failed: %o', error);\n        if (track) track.stop();\n      }\n    },\n    async disableMic() {\n      logger.debug('disableMic()');\n      if (!this.micProducer) return;\n\n      this.micProducer.close();\n\n      try {\n        await this.connection.invoke('CloseProducer', this.micProducer.id);\n      } catch (error) {\n        logger.error('disableMic() [error:\"%o\"]', error);\n      }\n\n      this.micProducer = null;\n      this.micClosed();\n    },\n    micClosed() {\n      if(this.micProducer)\n      {\n        this.micProducer.close();\n        this.micProducer = null;\n      }\n      this.localAudioStream = null;\n    },\n    async enableWebcam() {\n      logger.debug('enableWebcam()');\n\n      if (this.webcamProducer) return;\n      if (this.mediasoupDevice && !this.mediasoupDevice.canProduce('video')) {\n        logger.error('enableWebcam() | cannot produce video');\n        return;\n      }\n\n      let track;\n\n      try {\n        const deviceId = await this._getWebcamDeviceId();\n\n        logger.debug(`_setWebcamProducer() | webcam: ${deviceId}`);\n\n        const device = this.webcams.get(deviceId);\n\n        if (!device) throw new Error(`no webcam devices: ${JSON.stringify(this.webcams)}`);\n\n        logger.debug('_setWebcamProducer() | new selected webcam [device:%o]', device);\n\n        logger.debug('_setWebcamProducer() | calling getUserMedia()');\n\n        //const stream = await navigator.mediaDevices.getUserMedia({ video: true })\n        //*\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: {\n            deviceId: { ideal: deviceId },\n            ...VIDEO_CONSTRAINS.qvga\n          }\n        });\n        //*/\n        this.localVideoStream = stream;\n\n        track = stream.getVideoTracks()[0];\n\n        let encodings;\n        let codec;\n        const codecOptions =\n        {\n          videoGoogleStartBitrate : 1000\n        };\n      \n        if (this.forceH264)\n        {\n          codec = this.mediasoupDevice.rtpCapabilities.codecs\n            .find((c) => c.mimeType.toLowerCase() === 'video/h264');\n\n          if (!codec)\n          {\n            throw new Error('desired H264 codec+configuration is not supported');\n          }\n        }\n        else if (this.forceVP9)\n        {\n          codec = this.mediasoupDevice.rtpCapabilities.codecs\n            .find((c) => c.mimeType.toLowerCase() === 'video/vp9');\n\n          if (!codec)\n          {\n            throw new Error('desired VP9 codec+configuration is not supported');\n          }\n        }\n      \n        if (this.useSimulcast) {\n          // If VP9 is the only available video codec then use SVC.\n          const firstVideoCodec = this.mediasoupDevice.rtpCapabilities.codecs.find(\n            c => c.kind === 'video'\n          );\n\n          if (firstVideoCodec.mimeType.toLowerCase() === 'video/vp9')\n            encodings = WEBCAM_KSVC_ENCODINGS;\n          else encodings = WEBCAM_SIMULCAST_ENCODINGS;\n        }\n\n        this.webcamProducer = await this.sendTransport.produce({\n          track,\n          encodings,\n          codecOptions,\n          codec,\n          appData: { source: 'webcam' }\n        });\n\n        this.webcamProducer.on('transportclose', () => {\n          this.webcamProducer = null;\n        });\n\n        this.webcamProducer.on('trackended', () => {\n          this.disableWebcam().catch(() => {});\n        });\n        logger.debug('_setWebcamProducer() succeeded');\n      } catch (error) {\n        logger.error('_setWebcamProducer() failed:%o', error);\n\n        if (track) track.stop();\n      }\n    },\n    async disableWebcam() {\n      logger.debug('disableWebcam()');\n\n      if (!this.webcamProducer) return;\n\n      this.webcamProducer.close();\n\n      try {\n        await this.connection.invoke('CloseProducer', this.webcamProducer.id);\n      } catch (error) {\n        logger.error('disableWebcam() [error:\"%o\"]', error);\n      }\n\n      this.webcamProducer = null;\n      this.webcamClosed();\n    },\n    webcamClosed() {\n      if(this.webcamProducer)\n      {\n        this.webcamProducer.close();\n        this.webcamProducer = null;\n      }\n      this.localVideoStream = null;\n    },\n    async _updateAudioDevices() {\n      logger.debug('_updateAudioDevices()');\n\n      // Reset the list.\n      this.audioDevices = {};\n\n      try {\n        logger.debug('_updateAudioDevices() | calling enumerateDevices()');\n\n        const devices = await navigator.mediaDevices.enumerateDevices();\n\n        for (const device of devices) {\n          if (device.kind !== 'audioinput') continue;\n\n          this.audioDevices[device.deviceId] = device;\n        }\n      } catch (error) {\n        logger.error('_updateAudioDevices() failed: %o', error);\n      }\n    },\n    async _updateWebcams() {\n      logger.debug('_updateWebcams()');\n\n      // Reset the list.\n      this.webcams = new Map();\n\n      try {\n        logger.debug('_updateWebcams() | calling enumerateDevices()');\n\n        const devices = await navigator.mediaDevices.enumerateDevices();\n\n        logger.debug('_updateWebcams() | %o', devices);\n        for (const device of devices) {\n          if (device.kind !== 'videoinput') continue;\n          logger.debug('_updateWebcams() | %o', device);\n          this.webcams.set(device.deviceId, device);\n        }\n      } catch (error) {\n        logger.error('_updateWebcams() failed: %o', error);\n      }\n    },\n    async _getAudioDeviceId() {\n      logger.debug('_getAudioDeviceId()');\n\n      try {\n        logger.debug('_getAudioDeviceId() | calling _updateAudioDeviceId()');\n\n        await this._updateAudioDevices();\n\n        const audioDevices = Object.values(this.audioDevices);\n        return audioDevices[0] ? audioDevices[0].deviceId : null;\n      } catch (error) {\n        logger.error('_getAudioDeviceId() failed: %o', error);\n      }\n    },\n    async _getWebcamDeviceId() {\n      logger.debug('_getWebcamDeviceId()');\n\n      try {\n        logger.debug('_getWebcamDeviceId() | calling _updateWebcams()');\n\n        await this._updateWebcams();\n\n        const webcams = Array.from(this.webcams.values());\n        return webcams[0] ? webcams[0].deviceId : null;\n      } catch (error) {\n        logger.error('_getWebcamDeviceId() failed: %o', error);\n      }\n    }\n  }\n};\n</script>\n\n<style>\nbody {\n  margin: 0;\n  background-color: #313131;\n  color: #fff;\n}\n\n#app {\n  font-family: 'Avenir', Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#app > .el-container {\n  margin-bottom: 40px;\n}\n\n.el-header,\n.el-footer {\n  line-height: 60px;\n}\n\n.demo-block\n{\n  border:1px solid #ebebeb;\n  border-radius:3px;\n  transition:.2s;\n  background-color: #ececec;\n  padding-top: 16px;\n  margin-bottom: 8px;\n}\n\nvideo {\n  width: 360px;\n  background-color: #000;\n}\n\n /* 水平镜像翻转 */\n /*\nvideo#localVideo {\n    transform: rotateY(180deg);  \n}\n*/\n</style>\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=9a0ba664&\"\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import Vue from 'vue'\nimport ElementUI from 'element-ui'\nimport 'element-ui/lib/theme-chalk/index.css'\nimport App from './App.vue'\n\nVue.config.productionTip = false\n\nVue.use(ElementUI)\n\nnew Vue({\n  render: h => h(App),\n}).$mount('#app')\n"],"sourceRoot":""}