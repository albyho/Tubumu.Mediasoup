(function(e){function r(r){for(var a,c,i=r[0],s=r[1],u=r[2],p=0,m=[];p<i.length;p++)c=i[p],Object.prototype.hasOwnProperty.call(n,c)&&n[c]&&m.push(n[c][0]),n[c]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a]);d&&d(r);while(m.length)m.shift()();return o.push.apply(o,u||[]),t()}function t(){for(var e,r=0;r<o.length;r++){for(var t=o[r],a=!0,i=1;i<t.length;i++){var s=t[i];0!==n[s]&&(a=!1)}a&&(o.splice(r--,1),e=c(c.s=t[0]))}return e}var a={},n={app:0},o=[];function c(r){if(a[r])return a[r].exports;var t=a[r]={i:r,l:!1,exports:{}};return e[r].call(t.exports,t,t.exports,c),t.l=!0,t.exports}c.m=e,c.c=a,c.d=function(e,r,t){c.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,r){if(1&r&&(e=c(e)),8&r)return e;if(4&r&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(c.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var a in e)c.d(t,a,function(r){return e[r]}.bind(null,a));return t},c.n=function(e){var r=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(r,"a",r),r},c.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},c.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],s=i.push.bind(i);i.push=r,i=i.slice();for(var u=0;u<i.length;u++)r(i[u]);var d=s;o.push([0,"chunk-vendors"]),t()})({0:function(e,r,t){e.exports=t("56d7")},"034f":function(e,r,t){"use strict";t("85ec")},"56d7":function(e,r,t){"use strict";t.r(r);t("e260"),t("e6cf"),t("cca6"),t("a79d");var a=t("2b0e"),n=t("5c96"),o=t.n(n),c=(t("0fae"),function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{attrs:{id:"app"}},[t("el-container",[t("el-header",[e._v("Demo - 服务模式: "+e._s(e.serveModeText))]),t("el-container",[t("el-aside",{attrs:{width:"400px"}},[t("div",{staticClass:"demo-block"},[t("el-form",{ref:"connectForm",attrs:{inline:!0,"label-width":"80px",size:"mini"}},[t("el-form-item",{attrs:{label:"Peer:"}},[t("el-select",{attrs:{disabled:e.connectForm.isConnected,clearable:"",placeholder:"请选择"},model:{value:e.connectForm.peerId,callback:function(r){e.$set(e.connectForm,"peerId",r)},expression:"connectForm.peerId"}},e._l(e.accessTokens,(function(e,r){return t("el-option",{key:e,attrs:{label:"Peer "+r+(8==r||9===r?"(admin)":""),value:r}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleConnect}},[e._v(e._s(e.connectForm.isConnected?"Disconnect":"Connect"))])],1)],1)],1),e.connectForm.isConnected?t("div",{staticClass:"demo-block"},[t("el-form",{ref:"roomForm",attrs:{inline:!0,model:e.roomForm,"label-width":"80px",size:"mini"}},[t("el-form-item",{attrs:{label:"Room:"}},[t("el-select",{attrs:{disabled:e.roomForm.isJoinedRoom,clearable:"",placeholder:"请选择"},model:{value:e.roomForm.roomId,callback:function(r){e.$set(e.roomForm,"roomId",r)},expression:"roomForm.roomId"}},e._l(e.rooms,(function(e,r){return t("el-option",{key:e,attrs:{label:"Room "+r,value:r}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleJoinRoom}},[e._v(e._s(e.roomForm.isJoinedRoom?"Leave":"Join"))])],1)],1)],1):e._e(),e.connectForm.isConnected&&e.roomForm.isJoinedRoom?t("div",{staticClass:"demo-block"},[t("el-form",{ref:"peersForm",attrs:{model:e.peersForm,"label-width":"80px",size:"mini"}},[t("el-form-item",[t("el-table",{ref:"singleTable",staticStyle:{width:"100%"},attrs:{data:e.peersForm.peers,"highlight-current-row":""},on:{"current-change":e.onPeerNodeClick}},[t("el-table-column",{attrs:{type:"index",width:"50"}}),t("el-table-column",{attrs:{property:"displayName",label:"DisplayName"}})],1)],1)],1)],1):e._e()]),t("el-main",[e.webcamProducer?t("video",{ref:"localVideo",attrs:{id:"localVideo",autoplay:"",playsinline:""},domProps:{srcObject:e.localVideoStream}}):e._e(),e._l(e.remoteVideoStreams,(function(e,r){return t("video",{key:r,attrs:{autoplay:"",playsinline:""},domProps:{srcObject:e}})})),e._l(e.remoteAudioStreams,(function(e,r){return t("audio",{key:r,attrs:{autoplay:""},domProps:{srcObject:e}})}))],2)],1)],1)],1)}),i=[],s=t("b85c"),u=t("5530"),d=t("1da1"),p=(t("96cf"),t("4ec9"),t("d3b7"),t("3ca3"),t("ddb0"),t("2b3d"),t("ac1f"),t("5319"),t("841c"),t("25f0"),t("c19f"),t("a434"),t("7db0"),t("07ac"),t("a630"),t("d4ec")),m=t("bee2"),l=t("34eb"),b=t.n(l),f="tubumu-meeting-demo-client",v=function(){function e(r){Object(p["a"])(this,e),r?(this._debug=b()("".concat(f,":").concat(r)),this._warn=b()("".concat(f,":WARN:").concat(r)),this._error=b()("".concat(f,":ERROR:").concat(r))):(this._debug=b()(f),this._warn=b()("".concat(f,":WARN")),this._error=b()("".concat(f,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return Object(m["a"])(e,[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]),e}(),h=t("ddfa"),g=t("e87a"),w={qvga:{width:{ideal:320},height:{ideal:240}},vga:{width:{ideal:640},height:{ideal:480}},"720P":{width:{ideal:1280},height:{ideal:720}},"1080P":{width:{ideal:1920},height:{ideal:1080}},"4k":{width:{ideal:4096},height:{ideal:2160}}},k={optional:[{googDscp:!0}]},I=[{scaleResolutionDownBy:4,maxBitrate:5e5},{scaleResolutionDownBy:2,maxBitrate:1e6},{scaleResolutionDownBy:1,maxBitrate:5e6}],x=[{scalabilityMode:"S3T3_KEY"}],R=new v("App");localStorage.setItem("debug","mediasoup-client:* tubumu-meeting-demo-client:*");var y={name:"app",components:{},data:function(){return{serveMode:"Open",connection:null,mediasoupDevice:null,sendTransport:null,recvTransport:null,nextDataChannelTestNumber:0,webcams:{},audioDevices:{},webcamProducer:null,micProducer:null,useSimulcast:!1,forceH264:!1,forceVP9:!1,forceTcp:!0,localAudioStream:null,localVideoStream:null,remoteVideoStreams:{},remoteAudioStreams:{},producers:new Map,consumers:new Map,dataProducer:null,dataConsumers:new Map,connectForm:{peerId:null,isConnected:!1},roomForm:{roomId:[],isJoinedRoom:!1},peersForm:{peers:[]},defaultProps:{children:"children",label:"label"},form:{consume:!0,produce:!0,useDataChannel:!1},rooms:["Room 0","Room 1","Room 2","Room 3","Room 4","Room 5","Room 6","Room 7","Room 8","Room 9"],accessTokens:["eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiMCIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.lX6ff6ZFNb4z-4otDcUAZ48qwD8rZAGM5_Rt4HlHgug","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiMSIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.5w00ixg06pRPxcdbtbmRVI6Wy_Ta9qsSJc3D7PE3chQ","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiMiIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.q2tKWUa6i4u0VpZDhA8Fw92NoV_g9YQeWD-OeF7fAvU","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiMyIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.ekjd10Bortc1q34Ani1F_Gw9KQwS4qRFIU715pE1lGo","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiNCIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.6hZ4GtamurlemceCV7I5vT-UQkbszRxys5h8QOiOhcE","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiNSIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.nV4fr0tYGDR7zsykNoFYERdVSUPSqmhGdOkPqBjK1qw","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiNiIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.ftPY4GXCyyuaIaeihsexS99iluUCSZo6XSUOfdf_gGs","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiNyIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.V_S8YRRCOWP5-TG8S_cvlWdaXEKpsgY34lt3FiCgqGw","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiOCIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.fl1jA6DEQyXwIb6KRDUlEthR2G7-Je3OiaZHJ3tzk9M","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiOSIsIm5iZiI6MTU4NDM0OTA0NiwiZXhwIjoxNTg2OTQxMDQ2LCJpc3MiOiJpc3N1ZXIiLCJhdWQiOiJhdWRpZW5jZSJ9.3Hnnkoxe52L7joy99dXkcIjHtz9FUitf4BGYCYjyKdE"]}},computed:{isAdmin:function(){return 8===this.connectForm.peerId||9===this.connectForm.peerId},serveModeText:function(){return"Open"===this.serveMode?"开放(Open)模式":"Invite"===this.serveMode?"邀请(Invite)模式":"拉取(Pull)模式"}},mounted:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t=new URLSearchParams(location.search.replace("?","")),e.connectForm.peerId=t.get("peerId")||t.get("peerid"),e.connectForm.peerId&&(e.connectForm.peerId=parseInt(e.connectForm.peerId)),e.roomForm.roomId=t.get("roomId")||t.get("roomid"),e.roomForm.roomId&&(e.roomForm.roomId=parseInt(e.roomForm.roomId));case 5:case"end":return r.stop()}}),r)})))()},methods:{handleConnect:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!e.connectForm.isConnected){r.next=12;break}if(!e.connection){r.next=4;break}return r.next=4,e.connection.stop();case 4:return e.connectForm.isConnected=!1,e.roomForm.isJoinedRoom=!1,e.webcamClosed(),e.micClosed(),e.peersForm.peers=[],e.remoteVideoStreams={},e.remoteAudioStreams={},r.abrupt("return");case 12:if(e.connectForm.peerId||0===e.connectForm.peerId){r.next=15;break}return e.$message.error("Select a peer, please."),r.abrupt("return");case 15:return r.prev=15,t="",e.connection=(new g["b"]).withUrl("".concat(t,"/hubs/meetingHub"),{accessTokenFactory:function(){return e.accessTokens[e.connectForm.peerId]},skipNegotiation:!0,transport:g["a"].WebSockets}).build(),e.connection.onclose((function(r){e.connectForm.isConnected=!1,e.roomForm.isJoinedRoom=!1,e.peersForm.peers=[],e.disableMic(),e.disableWebcam(),r&&R.error(r)})),e.connection.on("Notify",function(){var r=Object(d["a"])(regeneratorRuntime.mark((function r(t){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,e.processNotification(t);case 2:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()),r.next=22,e.connection.start();case 22:return r.next=24,e.start();case 24:e.connectForm.isConnected=!0,r.next=30;break;case 27:r.prev=27,r.t0=r["catch"](15),R.debug(r.t0.message);case 30:case"end":return r.stop()}}),r,null,[[15,27]])})))()},start:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,e.connection.invoke("GetServeMode");case 2:if(t=r.sent,200===t.code){r.next=7;break}return R.error("start() | GetServeMode failed: ".concat(t.message)),e.$message.error("start() | GetServeMode failed: ".concat(t.message)),r.abrupt("return");case 7:return e.serveMode=t.data.serveMode,r.next=10,e.connection.invoke("GetRouterRtpCapabilities");case 10:if(t=r.sent,200===t.code){r.next=15;break}return R.error("start() | GetRouterRtpCapabilities failed: ".concat(t.message)),e.$message.error("start() | GetRouterRtpCapabilities failed: ".concat(t.message)),r.abrupt("return");case 15:return a=t.data,e.mediasoupDevice=new h["Device"],r.next=19,e.mediasoupDevice.load({routerRtpCapabilities:a});case 19:return r.next=21,e.connection.invoke("Join",{rtpCapabilities:e.mediasoupDevice.rtpCapabilities,sctpCapabilities:e.form.useDataChannel&&e.form.consume?e.mediasoupDevice.sctpCapabilities:void 0,displayName:null,sources:["mic","webcam"],appData:{}});case 21:if(t=r.sent,200===t.code){r.next=26;break}return R.error("processNotification() | Join failed: ".concat(t.message)),e.$message.error("processNotification() | Join failed: ".concat(t.message)),r.abrupt("return");case 26:case"end":return r.stop()}}),r)})))()},handleJoinRoom:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t,a,n,o,c;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!e.roomForm.isJoinedRoom){r.next=11;break}return r.next=3,e.connection.invoke("LeaveRoom");case 3:if(t=r.sent,200===t.code){r.next=8;break}return R.error("handleJoinRoom() | LeaveRoom failed: ".concat(t.message)),e.$message.error("handleJoinRoom() | LeaveRoom failed: ".concat(t.message)),r.abrupt("return");case 8:return e.peersForm.peers=[],e.roomForm.isJoinedRoom=!1,r.abrupt("return");case 11:if(e.roomForm.roomId||0===e.roomForm.roomId){r.next=14;break}return e.$message.error("Select a room, please."),r.abrupt("return");case 14:return r.next=16,e.connection.invoke("JoinRoom",{roomId:e.roomForm.roomId.toString(),role:e.isAdmin?"admin":"normal"});case 16:if(a=r.sent,200===a.code){r.next=21;break}return R.error("handleJoinRoom() | JoinRoom failed."),e.$message.error("handleJoinRoom() | JoinRoom failed: ".concat(a.message)),r.abrupt("return");case 21:for(n=a.data.peers,o=0;o<n.length;o++)e.peersForm.peers.push(n[o]);if(e.roomForm.isJoinedRoom=!0,!e.form.produce){r.next=37;break}return r.next=27,e.connection.invoke("CreateSendWebRtcTransport",{forceTcp:e.forceTcp,sctpCapabilities:e.form.useDataChannel?e.mediasoupDevice.sctpCapabilities:void 0});case 27:if(a=r.sent,200===a.code){r.next=32;break}return R.error("handleJoinRoom() | CreateSendWebRtcTransport failed: ".concat(a.message)),e.$message.error("handleJoinRoom() | CreateSendWebRtcTransport failed: ".concat(a.message)),r.abrupt("return");case 32:e.sendTransport=e.mediasoupDevice.createSendTransport({id:a.data.transportId,iceParameters:a.data.iceParameters,iceCandidates:a.data.iceCandidates,dtlsParameters:a.data.dtlsParameters,sctpParameters:a.data.sctpParameters,iceServers:[],proprietaryConstraints:k}),e.sendTransport.on("connect",(function(r,t,a){var n=r.dtlsParameters;R.debug("sendTransport.on() connect dtls: %o",n),e.connection.invoke("ConnectWebRtcTransport",{transportId:e.sendTransport.id,dtlsParameters:n}).then(t).catch(a)})),e.sendTransport.on("produce",function(){var r=Object(d["a"])(regeneratorRuntime.mark((function r(t,a,n){var o,c,i,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return o=t.kind,c=t.rtpParameters,i=t.appData,R.debug("sendTransport.on() produce, appData: %o",i),r.prev=2,r.next=5,e.connection.invoke("Produce",{transportId:e.sendTransport.id,kind:o,rtpParameters:c,source:i.source,appData:i});case 5:if(s=r.sent,200===s.code){r.next=11;break}return R.error("sendTransport 'produce' callbak | failed: ".concat(s.message)),e.$message.error("sendTransport 'produce' callbak | failed: ".concat(s.message)),n(new Error(s.message)),r.abrupt("return");case 11:e.producers.set(s.data.id,s.data),a({id:s.data.id}),r.next=18;break;case 15:r.prev=15,r.t0=r["catch"](2),n(r.t0);case 18:case"end":return r.stop()}}),r,null,[[2,15]])})));return function(e,t,a){return r.apply(this,arguments)}}()),e.sendTransport.on("producedata",function(){var r=Object(d["a"])(regeneratorRuntime.mark((function r(t,a,n){var o,c,i,s,u,d;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return o=t.sctpStreamParameters,c=t.label,i=t.protocol,s=t.appData,R.debug('"producedata" event: [sctpStreamParameters:%o, appData:%o]',o,s),r.prev=2,r.next=5,e._protoo.request("ProduceData",{transportId:e.sendTransport.id,sctpStreamParameters:o,label:c,protocol:i,appData:s});case 5:u=r.sent,d=u.id,a({id:d}),r.next=13;break;case 10:r.prev=10,r.t0=r["catch"](2),n(r.t0);case 13:case"end":return r.stop()}}),r,null,[[2,10]])})));return function(e,t,a){return r.apply(this,arguments)}}()),e.sendTransport.on("connectionstatechange",(function(r){R.debug("sendTransport.on() connectionstatechange: ".concat(r)),"connected"===r&&e.enableDataProducer()}));case 37:return r.next=39,e.connection.invoke("CreateRecvWebRtcTransport",{forceTcp:e.forceTcp,sctpCapabilities:e.form.useDataChannel?e._mediasoupDevice.sctpCapabilities:void 0});case 39:if(a=r.sent,e.recvTransport=e.mediasoupDevice.createRecvTransport({id:a.data.transportId,iceParameters:a.data.iceParameters,iceCandidates:a.data.iceCandidates,dtlsParameters:a.data.dtlsParameters,sctpParameters:a.data.sctpParameters,iceServers:[]}),e.recvTransport.on("connect",(function(r,t,a){var n=r.dtlsParameters;R.debug("recvTransport.on() connect dtls: %o",n),e.connection.invoke("ConnectWebRtcTransport",{transportId:e.recvTransport.id,dtlsParameters:n}).then(t).catch(a)})),e.recvTransport.on("connectionstatechange",(function(e){R.debug("recvTransport.on() connectionstatechange: ".concat(e))})),"Open"!==e.serveMode){r.next=48;break}return r.next=46,e.enableMic();case 46:return r.next=48,e.enableWebcam();case 48:if("Pull"===e.serveMode){r.next=56;break}return r.next=51,e.connection.invoke("Ready");case 51:if(c=r.sent,200===c.code){r.next=56;break}return R.error("Ready() | failed: ".concat(c.message)),e.$message.error("Ready() | failed: ".concat(c.message)),r.abrupt("return");case 56:case"end":return r.stop()}}),r)})))()},onPeerNodeClick:function(e){var r=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(R.debug("onPeerNodeClick() | %o",e),"Pull"!==r.serveMode){t.next=8;break}return t.next=6,r.pull(e.peerId,e.sources);case 6:t.next=15;break;case 8:if("Invite"!==r.serveMode){t.next=15;break}if(!r.isAdmin){t.next=14;break}return t.next=12,r.invite(e.peerId,e.sources);case 12:t.next=15;break;case 14:r.$message.error("仅管理员可进行邀请操作。");case 15:case"end":return t.stop()}}),t)})))()},processNewConsumer:function(e){var r=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var a,n,o,c,i,s,d,p,m,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.producerPeerId,n=e.producerId,o=e.consumerId,c=e.kind,i=e.rtpParameters,s=e.producerAppData,t.next=3,r.recvTransport.consume({id:o,producerId:n,kind:c,rtpParameters:i,appData:Object(u["a"])(Object(u["a"])({},s),{},{producerPeerId:a})});case 3:return d=t.sent,R.debug("processNewConsumer() Consumer: %o",d),r.consumers.set(d.id,d),d.on("transportclose",(function(){r.consumers.delete(d.id)})),p=h["parseScalabilityMode"](d.rtpParameters.encodings[0].scalabilityMode),p.spatialLayers,p.temporalLayers,m=new MediaStream,m.addTrack(d.track),r.$set("video"===c?r.remoteVideoStreams:r.remoteAudioStreams,o,m),R.debug("processNewConsumer() ResumeConsumer"),t.next=14,r.connection.invoke("ResumeConsumer",o);case 14:if(l=t.sent,200===l.code){t.next=19;break}return R.error("processNewConsumer() | ResumeConsumer failed: ".concat(l.message)),r.$message.error("processNewConsumer() | ResumeConsumer failed: ".concat(l.message)),t.abrupt("return");case 19:case"end":return t.stop()}}),t)})))()},processNewDataConsumer:function(e){var r=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var a,n,o,c,i,s,d,p;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.dataProducerPeerId,n=e.dataProducerId,o=e.dataCosumerId,c=e.sctpStreamParameters,i=e.label,s=e.protocol,d=e.dataProducerAppData,t.prev=1,t.next=4,r.recvTransport.consumeData({dataCosumerId:o,dataProducerId:n,sctpStreamParameters:c,label:i,protocol:s,appData:Object(u["a"])(Object(u["a"])({},d),{},{dataProducerPeerId:a})});case 4:p=t.sent,r.dataConsumers.set(p.id,p),p.on("transportclose",(function(){r.dataConsumers.delete(p.id)})),p.on("open",(function(){R.debug('DataConsumer "open" event')})),p.on("close",(function(){R.warn('DataConsumer "close" event'),r.dataConsumers.delete(p.id)})),p.on("error",(function(e){R.error('DataConsumer "error" event:%o',e)})),p.on("message",(function(e){if(R.debug('DataConsumer "message" event [streamId:%d]',p.sctpStreamParameters.streamId),e instanceof ArrayBuffer){var t=new DataView(e),a=t.getUint32();return a==Math.pow(2,32)-1?(R.warn("dataChannelTest finished!"),void(r.nextDataChannelTestNumber=0)):(a>r.nextDataChannelTestNumber&&R.warn("dataChannelTest: %s packets missing",a-r.nextDataChannelTestNumber),void(r.nextDataChannelTestNumber=a+1))}"string"===typeof e?R.debug("New message: ".concat(e)):R.warn('ignoring DataConsumer "message" (not a string)')})),t.next=17;break;case 13:throw t.prev=13,t.t0=t["catch"](1),R.error('"newDataConsumer" request failed:%o',t.t0),t.t0;case 17:case"end":return t.stop()}}),t,null,[[1,13]])})))()},pull:function(e,r){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.connection.invoke("Pull",{peerId:e,sources:r});case 2:if(n=a.sent,200===n.code){a.next=7;break}return R.error("pull() | failed: ".concat(n.message)),t.$message.error("pull() | failed: ".concat(n.message)),a.abrupt("return");case 7:case"end":return a.stop()}}),a)})))()},invite:function(e,r){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.connection.invoke("Invite",{peerId:e,sources:r});case 2:if(n=a.sent,200===n.code){a.next=7;break}return R.error("invite() | failed: ".concat(n.message)),t.$message.error("invite() | failed: ".concat(n.message)),a.abrupt("return");case 7:case"end":return a.stop()}}),a)})))()},processNotification:function(e){var r=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var a,n,o,c,i,s,u,d,p,m,l,b,f,v,h,g,w,k,I,x,y,C;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:R.debug("processNotification() | %o",e),t.t0=e.type,t.next="newConsumer"===t.t0?4:"newDataConsumer"===t.t0?7:"producerScore"===t.t0?10:"peerJoinRoom"===t.t0?12:"peerLeaveRoom"===t.t0?15:"peerRoomAppDataChanged"===t.t0?27:"produceSources"===t.t0?28:"downlinkBwe"===t.t0?47:"consumerClosed"===t.t0?49:"consumerPaused"===t.t0?57:"consumerResumed"===t.t0?62:"consumerLayersChanged"===t.t0?67:"consumerScore"===t.t0?72:"producerClosed"===t.t0?77:"peerLeave"===t.t0?83:"producerVideoOrientationChanged"===t.t0?93:94;break;case 4:return t.next=6,r.processNewConsumer(e.data);case 6:return t.abrupt("break",95);case 7:return t.next=9,r.processNewDataConsumer(e.data);case 9:return t.abrupt("break",95);case 10:return a=e.data,a.producerId,a.score,t.abrupt("break",95);case 12:return n=e.data.peer,r.peersForm.peers.push(n),t.abrupt("break",95);case 15:o=e.data.peerId,c=-1,i=0;case 18:if(!(i<r.peersForm.peers.length)){t.next=25;break}if(r.peersForm.peers[i].peerId!==o){t.next=22;break}return c=i,t.abrupt("break",25);case 22:i++,t.next=18;break;case 25:return c>=0&&r.peersForm.peers.splice(c,1),t.abrupt("break",95);case 27:return t.abrupt("break",95);case 28:if(r.form.produce){t.next=30;break}return t.abrupt("break",95);case 30:s=e.data.sources,u=0;case 32:if(!(u<s.length)){t.next=46;break}if("mic"!==s[u]||!r.mediasoupDevice.canProduce("audio")){t.next=39;break}if(r.micProducer){t.next=37;break}return t.next=37,r.enableMic();case 37:t.next=43;break;case 39:if("webcam"!==s[u]||!r.mediasoupDevice.canProduce("video")){t.next=43;break}if(r.webcamProducer){t.next=43;break}return t.next=43,r.enableWebcam();case 43:u++,t.next=32;break;case 46:return t.abrupt("break",95);case 47:return R.debug("'downlinkBwe' event: %o",e.data),t.abrupt("break",95);case 49:if(d=e.data.consumerId,p=r.consumers.get(d),p){t.next=53;break}return t.abrupt("break",95);case 53:return r.$delete("video"===p.kind?r.remoteVideoStreams:r.remoteAudioStreams,d),p.close(),r.consumers.delete(d),t.abrupt("break",95);case 57:if(m=e.data.consumerId,l=r.consumers.get(m),l){t.next=61;break}return t.abrupt("break",95);case 61:return t.abrupt("break",95);case 62:if(b=e.data.consumerId,f=r.consumers.get(b),f){t.next=66;break}return t.abrupt("break",95);case 66:return t.abrupt("break",95);case 67:if(v=e.data,h=v.consumerId,v.spatialLayer,v.temporalLayer,g=r.consumers.get(h),g){t.next=71;break}return t.abrupt("break",95);case 71:return t.abrupt("break",95);case 72:if(w=e.data.consumerId,k=r.consumers.get(w),k){t.next=76;break}return t.abrupt("break",95);case 76:return t.abrupt("break",95);case 77:if(I=e.data.producerId,x=r.producers.get(I),x){t.next=81;break}return t.abrupt("break",95);case 81:return"webcam"===x.source?r.webcamClosed():"mic"===x.source&&r.micClosed(),t.abrupt("break",95);case 83:y=e.data.peerId,C=r.peersForm.peers.length-1;case 85:if(!(C>0)){t.next=92;break}if(r.peersForm.peers[C].peerId!==y){t.next=89;break}return r.peersForm.peers.splice(C,1),t.abrupt("break",92);case 89:C--,t.next=85;break;case 92:return t.abrupt("break",95);case 93:return t.abrupt("break",95);case 94:R.error("unknown data.type, data:%o",e);case 95:case"end":return t.stop()}}),t)})))()},enableDataProducer:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(R.debug("enableChatDataProducer()"),e.form.useDataChannel){r.next=3;break}return r.abrupt("return");case 3:return r.prev=3,r.next=6,e.sendTransport.produceData({ordered:!1,maxRetransmits:1,label:"chat",priority:"medium",appData:{info:""}});case 6:e.dataProducer=r.sent,e.dataProducer.on("transportclose",(function(){e.dataProducer=null})),e.dataProducer.on("open",(function(){R.debug('DataProducer "open" event')})),e.dataProducer.on("close",(function(){R.error('DataProducer "close" event'),e.dataProducer=null})),e.dataProducer.on("error",(function(e){R.error('chat DataProducer "error" event:%o',e)})),e.dataProducer.on("bufferedamountlow",(function(){R.debug('chat DataProducer "bufferedamountlow" event')})),r.next=18;break;case 14:throw r.prev=14,r.t0=r["catch"](3),R.error("enableDataProducer() | failed:%o",r.t0),r.t0;case 18:case"end":return r.stop()}}),r,null,[[3,14]])})))()},enableMic:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t,a,n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(R.debug("enableMic()"),!e.micProducer){r.next=3;break}return r.abrupt("return");case 3:if(!e.mediasoupDevice||e.mediasoupDevice.canProduce("audio")){r.next=6;break}return R.error("enableMic() | cannot produce audio"),r.abrupt("return");case 6:return r.prev=6,r.next=9,e._getAudioDeviceId();case 9:if(a=r.sent,n=e.audioDevices[a],n){r.next=13;break}throw new Error("no audio devices");case 13:return R.debug("enableMic() | new selected audio device [device:%o]",n),R.debug("enableMic() | calling getUserMedia()"),r.next=17,navigator.mediaDevices.getUserMedia({audio:{deviceId:{ideal:a}}});case 17:return o=r.sent,e.localAudioStream=o,t=o.getAudioTracks()[0],r.next=22,e.sendTransport.produce({track:t,codecOptions:{opusStereo:1,opusDtx:1},appData:{source:"mic"}});case 22:e.micProducer=r.sent,e.micProducer.on("transportclose",(function(){e.micProducer=null})),e.micProducer.on("trackended",(function(){e.disableMic().catch((function(){}))})),e.micProducer.volume=0,r.next=33;break;case 28:r.prev=28,r.t0=r["catch"](6),console.log("enableMic() failed: %o",r.t0),R.error("enableMic() failed: %o",r.t0),t&&t.stop();case 33:case"end":return r.stop()}}),r,null,[[6,28]])})))()},disableMic:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(R.debug("disableMic()"),e.micProducer){r.next=3;break}return r.abrupt("return");case 3:return e.micProducer.close(),r.prev=4,r.next=7,e.connection.invoke("CloseProducer",e.micProducer.id);case 7:r.next=12;break;case 9:r.prev=9,r.t0=r["catch"](4),R.error('disableMic() [error:"%o"]',r.t0);case 12:e.micProducer=null,e.micClosed();case 14:case"end":return r.stop()}}),r,null,[[4,9]])})))()},micClosed:function(){this.micProducer&&(this.micProducer.close(),this.micProducer=null),this.localAudioStream=null},enableWebcam:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t,a,n,o,c,i,s,d;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(R.debug("enableWebcam()"),!e.webcamProducer){r.next=3;break}return r.abrupt("return");case 3:if(!e.mediasoupDevice||e.mediasoupDevice.canProduce("video")){r.next=6;break}return R.error("enableWebcam() | cannot produce video"),r.abrupt("return");case 6:return r.prev=6,r.next=9,e._getWebcamDeviceId();case 9:if(a=r.sent,R.debug("_setWebcamProducer() | webcam: ".concat(a)),n=e.webcams.get(a),n){r.next=14;break}throw new Error("no webcam devices: ".concat(JSON.stringify(e.webcams)));case 14:return R.debug("_setWebcamProducer() | new selected webcam [device:%o]",n),R.debug("_setWebcamProducer() | calling getUserMedia()"),r.next=18,navigator.mediaDevices.getUserMedia({video:Object(u["a"])({deviceId:{ideal:a}},w.qvga)});case 18:if(o=r.sent,e.localVideoStream=o,t=o.getVideoTracks()[0],s={videoGoogleStartBitrate:1e3},!e.forceH264){r.next=28;break}if(i=e.mediasoupDevice.rtpCapabilities.codecs.find((function(e){return"video/h264"===e.mimeType.toLowerCase()})),i){r.next=26;break}throw new Error("desired H264 codec+configuration is not supported");case 26:r.next=32;break;case 28:if(!e.forceVP9){r.next=32;break}if(i=e.mediasoupDevice.rtpCapabilities.codecs.find((function(e){return"video/vp9"===e.mimeType.toLowerCase()})),i){r.next=32;break}throw new Error("desired VP9 codec+configuration is not supported");case 32:return e.useSimulcast&&(d=e.mediasoupDevice.rtpCapabilities.codecs.find((function(e){return"video"===e.kind})),c="video/vp9"===d.mimeType.toLowerCase()?x:I),r.next=35,e.sendTransport.produce({track:t,encodings:c,codecOptions:s,codec:i,appData:{source:"webcam"}});case 35:e.webcamProducer=r.sent,e.webcamProducer.on("transportclose",(function(){e.webcamProducer=null})),e.webcamProducer.on("trackended",(function(){e.disableWebcam().catch((function(){}))})),R.debug("_setWebcamProducer() succeeded"),r.next=45;break;case 41:r.prev=41,r.t0=r["catch"](6),R.error("_setWebcamProducer() failed:%o",r.t0),t&&t.stop();case 45:case"end":return r.stop()}}),r,null,[[6,41]])})))()},disableWebcam:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(R.debug("disableWebcam()"),e.webcamProducer){r.next=3;break}return r.abrupt("return");case 3:return e.webcamProducer.close(),r.prev=4,r.next=7,e.connection.invoke("CloseProducer",e.webcamProducer.id);case 7:r.next=12;break;case 9:r.prev=9,r.t0=r["catch"](4),R.error('disableWebcam() [error:"%o"]',r.t0);case 12:e.webcamProducer=null,e.webcamClosed();case 14:case"end":return r.stop()}}),r,null,[[4,9]])})))()},webcamClosed:function(){this.webcamProducer&&(this.webcamProducer.close(),this.webcamProducer=null),this.localVideoStream=null},_updateAudioDevices:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t,a,n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return R.debug("_updateAudioDevices()"),e.audioDevices={},r.prev=2,R.debug("_updateAudioDevices() | calling enumerateDevices()"),r.next=6,navigator.mediaDevices.enumerateDevices();case 6:t=r.sent,a=Object(s["a"])(t),r.prev=8,a.s();case 10:if((n=a.n()).done){r.next=17;break}if(o=n.value,"audioinput"===o.kind){r.next=14;break}return r.abrupt("continue",15);case 14:e.audioDevices[o.deviceId]=o;case 15:r.next=10;break;case 17:r.next=22;break;case 19:r.prev=19,r.t0=r["catch"](8),a.e(r.t0);case 22:return r.prev=22,a.f(),r.finish(22);case 25:r.next=30;break;case 27:r.prev=27,r.t1=r["catch"](2),R.error("_updateAudioDevices() failed: %o",r.t1);case 30:case"end":return r.stop()}}),r,null,[[2,27],[8,19,22,25]])})))()},_updateWebcams:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t,a,n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return R.debug("_updateWebcams()"),e.webcams=new Map,r.prev=2,R.debug("_updateWebcams() | calling enumerateDevices()"),r.next=6,navigator.mediaDevices.enumerateDevices();case 6:t=r.sent,R.debug("_updateWebcams() | %o",t),a=Object(s["a"])(t),r.prev=9,a.s();case 11:if((n=a.n()).done){r.next=19;break}if(o=n.value,"videoinput"===o.kind){r.next=15;break}return r.abrupt("continue",17);case 15:R.debug("_updateWebcams() | %o",o),e.webcams.set(o.deviceId,o);case 17:r.next=11;break;case 19:r.next=24;break;case 21:r.prev=21,r.t0=r["catch"](9),a.e(r.t0);case 24:return r.prev=24,a.f(),r.finish(24);case 27:r.next=32;break;case 29:r.prev=29,r.t1=r["catch"](2),R.error("_updateWebcams() failed: %o",r.t1);case 32:case"end":return r.stop()}}),r,null,[[2,29],[9,21,24,27]])})))()},_getAudioDeviceId:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return R.debug("_getAudioDeviceId()"),r.prev=1,R.debug("_getAudioDeviceId() | calling _updateAudioDeviceId()"),r.next=5,e._updateAudioDevices();case 5:return t=Object.values(e.audioDevices),r.abrupt("return",t[0]?t[0].deviceId:null);case 9:r.prev=9,r.t0=r["catch"](1),R.error("_getAudioDeviceId() failed: %o",r.t0);case 12:case"end":return r.stop()}}),r,null,[[1,9]])})))()},_getWebcamDeviceId:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return R.debug("_getWebcamDeviceId()"),r.prev=1,R.debug("_getWebcamDeviceId() | calling _updateWebcams()"),r.next=5,e._updateWebcams();case 5:return t=Array.from(e.webcams.values()),r.abrupt("return",t[0]?t[0].deviceId:null);case 9:r.prev=9,r.t0=r["catch"](1),R.error("_getWebcamDeviceId() failed: %o",r.t0);case 12:case"end":return r.stop()}}),r,null,[[1,9]])})))()}}},C=y,D=(t("034f"),t("2877")),P=Object(D["a"])(C,c,i,!1,null,null,null),O=P.exports;a["default"].config.productionTip=!1,a["default"].use(o.a),new a["default"]({render:function(e){return e(O)}}).$mount("#app")},"85ec":function(e,r,t){}});
//# sourceMappingURL=app.cc9f5ad7.js.map